<?php

use Drupal\Component\Utility\Unicode;
use Drupal\Core\Path\PathMatcher;
use Drupal\Core\Url;

//adding livechat code when conditions are met
function livechat_page_attachments(array &$page) {
 
  $config = \Drupal::config('livechat.settings');
  
  $path = \Drupal::service('path.current')->getPath();
  
  if (empty($config->get('licence_number'))) {
    return;
  }
  
  if (_livechat_active($path)) return;
  
 
  $js_settings = [
    'licence_number' => $config->get('licence_number'),
  ];

  $page['#attached']['drupalSettings']['livechat'] = $js_settings;

  $page['#attached']['library'][] = 'livechat/livechat';
  
}

//checking if url contains "admin" 
function _livechat_active($path) {
 
  $page_match = false;
  
  if(strpos($path,"admin")){
	  $page_match = true ; 
  }

  return $page_match;
}

 //this hook takes care of chaning default settings for submit button and adds 
 //custom css to the form when livechat_loging input field is disabled
 function livechat_form_livechat_admin_settings_form_alter(&$form, &$form_state, $form_id) {
	 
	$form['actions']['submit']['#value'] = "Save configuration";
	
	$form['actions']['submit']['#states'] = array(
				'visible' => array(
					':input[name="settings"]' => array('value' => '1'),
				),
			);
	
	if($form['livechat_login']['#attributes']['disabled']) {
		$form['actions']['submit']['#value'] = "Reset LiveChat Settings";
		$form['#attached']['library'] = 'livechat/livechat';
	}else{
		$form['actions']['submit']['#attributes'] = array(
			'class' => array('container-inline'),
			'style' => array('margin-top: 10px;')
		);
	}

}
